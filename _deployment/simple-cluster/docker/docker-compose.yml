version: '3.8'

services:
  #ubuntu:
  #  image: ubuntu:latest
  #  command: tail -f /dev/null

  memdb-clusterdb:
    image: bitnami/etcd:latest
    container_name: memdb-clusterdb
    ports:
      - "2379:2379"
    environment:
      - ALLOW_NONE_AUTHENTICATION=yes
      - ETCDCTL_API=3
    logging:
      driver: none
    restart: always

  memdb-clustermanager:
    image: jaimetruman/memdb-clustermanager:1.0
    container_name: memdb-clustermanager
    ports:
      - "8080:8080"
    depends_on:
      - memdb-clusterdb
    environment:
      - MEMDB_CLUSTERMANAGER_HEALTHCHECK_PERIOD=240
      - MEMDB_CLUSTERMANAGER_DO_LOGGING=false
      - MEMDB_CLUSTERMANAGER_ETCD_ENDPOINTS=memdb-clusterdb:2379
    restart: always

  memdb-clusternode-1:
    image: jaimetruman/memdb-core:1.0
    container_name: memdb-clusternode-1
    depends_on:
      - memdb-clustermanager
    ports:
      - "10000:10000"
    environment:
      - SHOW_DEBUG_LOG=true
      - SERVER_PORT=10000
      - USE_REPLICATION=true
      - CLUSTER_MANAGER_ADDRESS=memdb-clustermanager:8080
      - ETCD_ADDRESSES=memdb-clusterdb:2379
      - NODE_ID=1

  memdb-clusternode-2:
    image: jaimetruman/memdb-core:1.0
    container_name: memdb-clusternode-2
    depends_on:
      - memdb-clustermanager
    ports:
      - "10001:10001"
    environment:
      - SHOW_DEBUG_LOG=true
      - SERVER_PORT=10001
      - USE_REPLICATION=true
      - CLUSTER_MANAGER_ADDRESS=memdb-clustermanager:8080
      - ETCD_ADDRESSES=memdb-clusterdb:2379
      - NODE_ID=2
